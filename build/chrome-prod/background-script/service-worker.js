var IS_DEV_BUILD=false;
(()=>{var C=Object.defineProperty;var O=(n,e)=>{for(var t in e)C(n,t,{get:e[t],enumerable:!0})};var w="screenshot",x=chrome?.i18n?.getMessage("@@extension_id"),Te=w+"/"+x,v="G-19Y7T52NBH",L="Cu0vRk7eTX21s66ymUrdIQ",A="https://forms.gle/oXHY8SXFMXN37SG69",Ne="https://chrome.google.com/webstore/detail/"+x;async function p(){let{sessionData:n}=await chrome.storage.session.get("sessionData"),e=Date.now();return n&&n.timestamp&&((e-n.timestamp)/6e4>30?n=null:(n.timestamp=e,await chrome.storage.session.set({sessionData:n}))),n||(n={session_id:e.toString(),timestamp:e.toString()},await chrome.storage.session.set({sessionData:n})),n.session_id}var U="https://www.google-analytics.com/mp/collect",P="https://www.google-analytics.com/debug/mp/collect",F=v,G=L,B=100,g=class{debug=IS_DEV_BUILD;constructor(){}async getOrCreateClientId(){let{clientId:e}=await chrome.storage.local.get("clientId");return e||(e=self.crypto.randomUUID(),await chrome.storage.local.set({clientId:e})),e}async getSessionId(){try{return p()}catch{return new Promise(t=>{chrome.runtime.sendMessage("get_or_create_session_id",o=>{t(o)})})}}async fireEvent(e,t={}){t.session_id||(t.session_id=await this.getSessionId()),t.engagement_time_msec||(t.engagement_time_msec=B);try{let o=await fetch(`${this.debug?P:U}?measurement_id=${F}&api_secret=${G}`,{method:"POST",body:JSON.stringify({client_id:await this.getOrCreateClientId(),events:[{name:e,params:t}]})});if(!this.debug)return;console.log(await o.text())}catch(o){console.error("Google Analytics request failed with an exception",o)}}async firePageViewEvent(e,t,o={}){return this.fireEvent("page_view",{page_title:e,page_location:t,...o})}async fireErrorEvent(e,t={}){return this.fireEvent("exception",{description:e.message,...e,...t})}},m=new g;var D=w,_=class{tag="";analytics=new g;constructor(e){this.tag=D+"."+(typeof e=="string"?e:e.constructor.name),this.listenForBgLogs()}listenForBgLogs(){chrome?.runtime?.onMessage.addListener((e,t)=>{t.id!==chrome.runtime.id||e.action!="log"||this.internalLogTagOverride(e.data.level,e.data.tag,...e.data.messages)})}debug=(...e)=>this.internalLog(3,...e);log=(...e)=>this.internalLog(2,...e);warn=(...e)=>this.internalLog(1,...e);error=(...e)=>this.internalLog(0,...e);internalLog(e,...t){this.internalLogTagOverride(e,this.tag,...t)}internalLogTagOverride(e,t,...o){let a=new Date(Date.now()),i=["%c%s %s","color: blue",`[${a.getHours()}:${a.getMinutes()}:${a.getSeconds()}]`,t,...o];if(IS_DEV_BUILD)switch(e){case 3:console.debug(...i);break;case 1:console.warn(...i);break;case 2:console.log(...i);break;case 0:console.error(...i);break}else{switch(e){case 1:this.analytics.fireErrorEvent(new Error(i.join(" ")));break;case 0:this.analytics.fireErrorEvent(new Error(i.join(" ")));break}return}}},f=class{tag="";constructor(e){this.tag=D+"."+(typeof e=="string"?e:e.constructor.name)}debug=(...e)=>this.internalLog(3,...e);log=(...e)=>this.internalLog(2,...e);warn=(...e)=>this.internalLog(1,...e);error=(...e)=>this.internalLog(0,...e);internalLog(e,...t){chrome.tabs.query({active:!0,currentWindow:!0},o=>{o.length===1&&chrome.tabs.sendMessage(o[0].id,{action:"log",data:{level:e,tag:this.tag,messages:t}})})}};var b={};O(b,{"@testMarkup":()=>$,All_done_:()=>ue,Cloned_the_repository_at____________a_href__https___github_com_justiceo_xtension__https___github_com_justiceo_xtension__a____________and_installed_all_the_dependencies_:()=>ne,Disable_storage_sync:()=>Y,Disabled_on_Websites:()=>X,Enabled_dev_mode_on_Chrome_Firefox_and_installed_an_unpacked___________extension___:()=>se,Extension_will_not_run_on_these_sites__Enter_one_site_per_line_:()=>J,Glad_you_like_it__Can_you_help_us_share_the____:()=>Ie,Hooray____:()=>ee,How_are_we_doing_:()=>we,How_can_we_improve_:()=>z,I_say_that_is_great_progress_towards_creating_a_browser_extension_:()=>ie,If_you_are_looking_at_this_page__you_successfully:()=>te,If_you_found_this_extension_helpful__leave_a_star_on_the_Github_Page_________or_rating_on_Chrome_Webstore_:()=>me,Next__Pin_it:()=>ae,No:()=>Ee,Options:()=>pe,Rate_on_Chrome_Web_Store:()=>he,Report_an_Issue:()=>be,Share_the_love_:()=>ge,Show_Demo:()=>fe,Star_on_GitHub:()=>de,Submit_Feedback:()=>ye,Successfully_updated_settings:()=>Q,Temporarily_disable_extension:()=>q,Thanks_for_the_feedback_:()=>Se,Turns_off_the_extension_on_all_websites_:()=>V,Used_ESBuild_to_build_the_source_code_and_packaged_into_store_ready___________format_:()=>oe,Welcome:()=>Z,Your_settings_will_not_propagate_to_other_browsers_:()=>K,_strong_1___strong__Click_on_the_extensions_icon_:()=>ce,_strong_2___strong__Find__Browser_Extension_Starter__in_the_list_of_______extensions_:()=>le,_strong_3___strong__Click_on_the_pin_icon_on_the_right_of_this_______extension_s_icon_:()=>_e,const_appDesc:()=>j,const_appName:()=>W,const_appShortName:()=>H,default:()=>xe,or_you_were_able_to_start_an_instance_of_Puppeteer_with_the___________extension_installed_:()=>re});var W={message:"Visual Snippets: Screenshot, Annotate & Share",description:"The name of the extension"},H={message:"Screenshot",description:"The short-version name of the extension name"},j={message:"Capture, annotate screenshots of webpages and share with one click",description:"The description of your extension"},$={message:"<div><p>Hello world</p>This is the <strong>language</strong> of the web</div>"},q={message:"Temporarily disable extension"},V={message:"Turns off the extension on all websites."},Y={message:"Disable storage sync"},K={message:"Your settings will not propagate to other browsers."},X={message:"Disabled on Websites"},J={message:"Extension will not run on these sites. Enter one site per line."},Q={message:"Successfully updated settings"},z={message:"How can we improve?"},Z={message:"Welcome"},ee={message:"Hooray! \u{1F389}"},te={message:"If you are looking at this page, you successfully"},ne={message:`Cloned the repository at
<a href="https://github.com/justiceo/xtension">https://github.com/justiceo/xtension</a>
and installed all the dependencies.`},oe={message:`Used ESBuild to build the source code and packaged into store-ready
format.`},se={message:`Enabled dev mode on Chrome/Firefox and installed an unpacked
extension...`},re={message:`or you were able to start an instance of Puppeteer with the
extension installed.`},ie={message:"I say that is great progress towards creating a browser extension."},ae={message:"Next: Pin it"},ce={message:"<strong>1.</strong> Click on the extensions icon."},le={message:`<strong>2.</strong> Find "Browser Extension Starter" in the list of
extensions.`},_e={message:`<strong>3.</strong> Click on the pin icon on the right of this
extension's icon.`},ue={message:"All done."},ge={message:"Share the love!"},me={message:`If you found this extension helpful, leave a star on the Github Page
or rating on Chrome Webstore.`},de={message:"Star on GitHub"},he={message:"Rate on Chrome Web Store"},pe={message:"Options"},fe={message:"Show Demo"},be={message:"Report an Issue"},we={message:"How are we doing?"},Ie={message:"Glad you like it! Can you help us share the \u2764\uFE0F?"},Se={message:"Thanks for the feedback!"},Ee={message:"No"},ye={message:"Submit Feedback"},xe={const_appName:W,const_appShortName:H,const_appDesc:j,"@testMarkup":$,Temporarily_disable_extension:q,Turns_off_the_extension_on_all_websites_:V,Disable_storage_sync:Y,Your_settings_will_not_propagate_to_other_browsers_:K,Disabled_on_Websites:X,Extension_will_not_run_on_these_sites__Enter_one_site_per_line_:J,Successfully_updated_settings:Q,How_can_we_improve_:z,Welcome:Z,Hooray____:ee,If_you_are_looking_at_this_page__you_successfully:te,Cloned_the_repository_at____________a_href__https___github_com_justiceo_xtension__https___github_com_justiceo_xtension__a____________and_installed_all_the_dependencies_:ne,Used_ESBuild_to_build_the_source_code_and_packaged_into_store_ready___________format_:oe,Enabled_dev_mode_on_Chrome_Firefox_and_installed_an_unpacked___________extension___:se,or_you_were_able_to_start_an_instance_of_Puppeteer_with_the___________extension_installed_:re,I_say_that_is_great_progress_towards_creating_a_browser_extension_:ie,Next__Pin_it:ae,_strong_1___strong__Click_on_the_extensions_icon_:ce,_strong_2___strong__Find__Browser_Extension_Starter__in_the_list_of_______extensions_:le,_strong_3___strong__Click_on_the_pin_icon_on_the_right_of_this_______extension_s_icon_:_e,All_done_:ue,Share_the_love_:ge,If_you_found_this_extension_helpful__leave_a_star_on_the_Github_Page_________or_rating_on_Chrome_Webstore_:me,Star_on_GitHub:de,Rate_on_Chrome_Web_Store:he,Options:pe,Show_Demo:fe,Report_an_Issue:be,How_are_we_doing_:we,Glad_you_like_it__Can_you_help_us_share_the____:Ie,Thanks_for_the_feedback_:Se,No:Ee,Submit_Feedback:ye};var I=new _("i18n");function ve(n){let e=/^[a-zA-Z0-9_]+$/;return n.split("").map(t=>e.test(t)?t:"_").join("")}var c=n=>{if(!n)return I.error("A valid key is required for i18n, got",n),n;let e=n.startsWith("@")?n:ve(n);if(chrome?.i18n&&chrome.i18n.getMessage(e)!=="")return chrome.i18n.getMessage(e);I.warn("chrome.i18n is not available in the current context, falling back to en-US"),Object.keys(b).forEach(t=>{});for(let[t,o]of Object.entries(b))if(t===e)return o.message;return I.error("No translation available for key:",n),n};var k=[{menu:{id:"open-gallery",title:"Screenshot Gallery",visible:!0,contexts:["action"]},handler:n=>{chrome.tabs.create({url:chrome.runtime.getURL("standalone/gallery.html"),active:!0})}}],T=[{id:"disable-extension-on-site",type:"checkbox",title:c("Temporarily disable extension"),description:c("Turns off the extension on all websites."),default_value:!1},{id:"disable-sync",type:"checkbox",title:c("Disable storage sync"),description:c("Your settings will not propagate to other browsers."),default_value:!1,dev_only:!1},{id:"blocked-sites",type:"textarea",title:c("Disabled on Websites"),description:c("Extension will not run on these sites. Enter one site per line."),default_value:""}];var d="feedback_data",h="install_time_ms",N="successful_interactions",S=class{storageService;constructor(){this.storageService=chrome?.storage?.local??window.localStorage}put(e,t){if(t==null)return Promise.reject("Attempting to save a null value");if(!e)return Promise.reject("Attempting to use a null key");if(!chrome?.storage?.sync)return this.storageService.setItem(e,JSON.stringify(t));let o={};return o[e]=t,this.storageService.set(o)}async get(e){return chrome?.storage?.sync?(await this.storageService.get(e))[e]:JSON.parse(this.storageService.getItem(e))}async remove(e){return e?chrome?.storage?.sync?this.storageService.remove(e):this.storageService.removeItem(e):Promise.reject("Attempting to use a null key")}async getConfig(e){return await this.get(e)??T.find(t=>t.id===e)?.default_value}getAll(){return this.storageService.get(null)}async getAndUpdate(e,t){let o=await this.get(e);return this.put(e,await t(o))}async isCurrentSiteBlocked(){let e=await this.get("blocked-sites");return!!(e&&window.location.hostname&&e.includes(window.location.hostname))}},r=new S;var Le=chrome.runtime.getURL("welcome/welcome2.html"),Ae=n=>{r.put(h,Date.now()),n.reason==="install"&&(m.fireEvent("install"),chrome.tabs.create({url:Le,active:!0})),chrome.runtime.setUninstallURL(A,()=>{m.fireEvent("uninstall"),chrome.runtime.lastError&&console.error("Error setting uninstall URL",chrome.runtime.lastError)})};chrome.runtime.onInstalled.addListener(Ae);var E=class{logger=new f(this);RELOAD_ACTION={menu:{id:"reload-extension",title:"Reload Extension",visible:!0,contexts:["action"]},handler:e=>{chrome.runtime.reload()}};CLEAR_STORAGE={menu:{id:"clear-storage",title:"Clear Storage",visible:!0,contexts:["action"]},handler:e=>{chrome.storage.sync.clear(),chrome.storage.local.clear()}};PRINT_STORAGE={menu:{id:"print-storage",title:"Print Storage",visible:!0,contexts:["action"]},handler:async e=>{this.logger.log("Storage contents:",await r.getAll())}};DISABLE_ON_SITE={menu:{id:"disable-on-site",title:"Disable on this site",visible:!0,contexts:["action"]},handler:e=>{r.getAndUpdate("blocked-sites",async t=>{let o;try{let l=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0].url??"";o=new URL(l)}catch(i){return this.logger.debug("Unable to parse url:",i),t}return o?t?t+`
`+o.hostname:o.hostname:(this.logger.debug("URL is null"),t)})}};browserActionContextMenu=[this.DISABLE_ON_SITE,...k];init=()=>{if(IS_DEV_BUILD&&this.browserActionContextMenu.push(this.RELOAD_ACTION,this.CLEAR_STORAGE,this.PRINT_STORAGE),!chrome||!chrome.contextMenus){this.logger.warn("No access to chrome.contextMenus");return}chrome.contextMenus.removeAll(),this.browserActionContextMenu.forEach(e=>chrome.contextMenus.create(e.menu)),chrome.contextMenus.onClicked.addListener(this.onClick)};onClick=(e,t)=>{let o=this.browserActionContextMenu.find(a=>a.menu.id===e.menuItemId);o?(m.fireEvent("context_menu_click",{menu_id:e.menuItemId}),o.handler(e,t)):this.logger.error("Unable to find menu item: ",e)};sendMessage(e){chrome.tabs.query({active:!0,currentWindow:!0},t=>{chrome.tabs.sendMessage(t[0].id,e,o=>{this.logger.debug("ack:",o)})})}};new E().init();chrome.tabs.onUpdated.addListener((n,e,t)=>{chrome.tabs.get(n,o=>M(o.url))});chrome.tabs.onActivated.addListener(n=>{chrome.tabs.get(n.tabId,e=>M(e.url))});var M=n=>{};var y=class{DAY_MS=864e5;logger=new _(this);async runFeedbackCheck(e){if(await this.shouldRequestFeedback(e)){let o={status:"eligible",timestamp:Date.now()};r.put(d,o);return}if((await r.get(d))?.status=="eligible"){let o={status:"ineligible",timestamp:Date.now()};r.put(d,o);return}}async shouldRequestFeedback(e){let t=!await this.isIncognito(e),o=await this.isSignedInToGoogle(),a=await this.getDaysSinceInstallation()>7,i=await this.getSuccessCount()>=30,l=await this.isEligibleForReissue(),u=t&&o&&a&&i&&l;return this.logger.debug(`isEligible: ${u}. Based on 
      isNormalWindow: ${t}, 
      isSignedIn: ${o}, 
      isAgedInstallation: ${a}, 
      hasSufficientSuccessfulInteractions: ${i}, 
      isEligibleForReissue: ${l}`),u}async isIncognito(e){if(e&&e.incognito)return Promise.resolve(!0);let o=(await chrome.tabs.query({active:!0,currentWindow:!0})).find(a=>a.incognito);return Promise.resolve(o!==void 0)}async getSuccessCount(){let e=await r.get(N);return e?Promise.resolve(e.length):Promise.resolve(0)}isSignedInToGoogle(){return new Promise(e=>{chrome.cookies.get({url:"https://accounts.google.com",name:"LSID"},t=>{e(!!t)})})}async getDaysSinceInstallation(){let e=await r.get(h);if(!e)return await r.put(h,Date.now()),Promise.resolve(0);let t=Date.now()-e,o=Math.ceil(t/(1e3*60*60*24));return Promise.resolve(o)}async isEligibleForReissue(){let e=await r.get(d);return e&&e.status==="honored"?Promise.resolve(!1):Promise.resolve(!0)}},R=new y;chrome.tabs.onActivated.addListener(n=>{chrome.tabs.get(n.tabId,e=>R.runFeedbackCheck(e))});chrome.tabs.onUpdated.addListener((n,e,t)=>{chrome.tabs.get(n,o=>R.runFeedbackCheck(o))});chrome.action.onClicked.addListener(async n=>{if(n.url.startsWith("file://")&&!await chrome.extension.isAllowedFileSchemeAccess()){chrome.tabs.create({url:chrome.runtime.getURL("standalone/snip.html")+"?error=noFileAccess",index:n.index});return}chrome.tabs.captureVisibleTab(async e=>{let t=`screenshot_${Date.now()}`,o=new Date,a={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0},i=o.toLocaleString("en-US",a),l={key:t,dataUrl:e,createdAt:Date.now(),hr_date:i,url:n.url,title:n.title};try{await r.put(t,l),chrome.tabs.create({url:chrome.runtime.getURL("standalone/snip.html")+"?key="+t,index:n.index})}catch(u){u.message.includes("QUOTA_BYTES_PER_ITEM")?chrome.tabs.create({url:chrome.runtime.getURL("standalone/snip.html")+"?error=storageQuotaExceeded",index:n.index}):console.error("Failed to save screenshot:",u)}})});var De=(n,e,t)=>{if(!e.id||e.id!==chrome.i18n.getMessage("@@extension_id")){console.warn("Ignoring message from unknown sender",e);return}if(console.log("Received message: ",n," from: ",e),n==="get_or_create_session_id")return p().then(o=>{console.log("Sending session Id",o),t(o)}),!0};chrome.runtime.onMessage.addListener(De);})();
